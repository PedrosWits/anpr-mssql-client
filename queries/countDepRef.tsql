USE CortexDBWarehouse
GO

select 
    t2.name as TableName,
    count(t.name) as FK_References,
    count() as FK_Dependencies
from 
    sys.foreign_key_columns as fk
inner join 
    sys.tables as t on fk.parent_object_id = t.object_id
inner join 
    sys.columns as c on fk.parent_object_id = c.object_id and fk.parent_column_id = c.column_id
join
    sys.tables as t2 on fk.referenced_object_id = t2.object_id
GROUP BY
    t2.name
GO
